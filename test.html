<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>GitHub JSON Editor</title>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3/dist/cdn.min.js" defer></script>
  <style>
    body { font-family:sans-serif; padding:2rem; max-width:600px; margin:auto }
    textarea { width:100%; height:200px; font-family:monospace; margin-bottom:1rem }
    button { padding:.6rem 1.2rem; background:#007acc; color:#fff; border:none; border-radius:4px; cursor:pointer }
    button:disabled { background:#8aa; }
    .status { margin-top:.5rem; color:#555 }
  </style>
</head>
<body x-data="editor()" x-init="load()">

  <h1>GitHub JSON ç·¨è¼¯å™¨</h1>

  <textarea x-model="content"></textarea>
  <br>
  <button @click="save()" :disabled="saving">
    <template x-if="!saving">ğŸ’¾ å­˜å› GitHub</template>
    <template x-if="saving">â³ å­˜æª”ä¸­â€¦</template>
  </button>
  <div class="status" x-text="status"></div>

  <script>
    function editor() {
      return {
        content: '',
        saving: false,
        status: '',

        async load() {
          this.status = 'è®€å–ä¸­â€¦';
          try {
            const res = await fetch('/.netlify/functions/getData');
            this.content = await res.text();
            this.status = 'âœ… è®€å–å®Œæˆ';
          } catch (e) {
            this.status = 'âŒ è®€å–å¤±æ•—ï¼š' + e.message;
          }
        },

        async save() {
          let parsed;
          try {
            parsed = JSON.parse(this.content);
          } catch {
            this.status = 'âŒ JSON æ ¼å¼éŒ¯èª¤';
            return;
          }
          this.saving = true;
          this.status = 'å­˜æª”ä¸­â€¦';
          try {
            const res = await fetch('/.netlify/functions/updateData', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(parsed)
            });
            if (!res.ok) throw new Error(await res.text());
            this.status = 'âœ… å­˜æª”æˆåŠŸ';
          } catch (e) {
            this.status = 'âŒ å­˜æª”å¤±æ•—ï¼š' + e.message;
          } finally {
            this.saving = false;
          }
        }
      }
    }
  </script>
</body>
</html>
